<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>HLS Player</title>
</head>

<body>
    <video playsinline autoplay muted preload="true" id="video" height="auto" controls></video>
    <div id="metadata"></div>
    <script src="video-js-file"></script>


    <script>

        const videoElement = document.getElementById('video');
        var player = videojs('video', {
            html5: {
                vhs: {
                    overrideNative: true
                },
                useCueTags: true,

                nativeAudioTracks: false,
                nativeVideoTracks: false
            }
        });

        player.src({
            src: '/events/1/output.m3u8',
            type: 'application/x-mpegURL',
            withCredentials: true
        });

        player.on('loadedmetadata', function () {
            setTimeout(() => {
                let tracks = player.textTracks();
                
                let segmentMetadataTrack;

                for (let i = 0; i < tracks.length; i++) {
                    if (tracks[i].label === 'segment-metadata') {
                        segmentMetadataTrack = tracks[i];
                        segmentMetadataTrack.mode = 'hidden'
                    }
                }

                

                let previousPlaylist;

                if (segmentMetadataTrack) {
                    segmentMetadataTrack.oncuechange =  function () {
                        // console.log('tracks', tracks)
                        // console.log('segmentMetadataTrack', segmentMetadataTrack)
                        let activeCue = segmentMetadataTrack.activeCues[0];
                        console.log('activeCue', activeCue.value)
                        if (activeCue) {
                            if (previousPlaylist !== activeCue.value.playlist) {
                                console.log('Switched from rendition ' + previousPlaylist +
                                    ' to rendition ' + activeCue.value.playlist);
                            }
                            previousPlaylist = activeCue.value.playlist;
                        }
                    };
                }

                // debugger
            }, 1000)

        });
    </script>
</body>

</html>